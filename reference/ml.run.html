<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>run machine learning models — ml.run • ezML</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="run machine learning models — ml.run"><meta name="description" content="This function compiles tools in caret packages to provide a machine learning (ML)
interface where users only need to provide the name of the ML method and the rest
are handled automatically."><meta property="og:description" content="This function compiles tools in caret packages to provide a machine learning (ML)
interface where users only need to provide the name of the ML method and the rest
are handled automatically."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ezML</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/ezML-intro.html">ezML-intro</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/blueskypie/ezML/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>run machine learning models</h1>
      <small class="dont-index">Source: <a href="https://github.com/blueskypie/ezML/blob/master/R/ML.funs.r" class="external-link"><code>R/ML.funs.r</code></a></small>
      <div class="d-none name"><code>ml.run.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function compiles tools in <code>caret</code> packages to provide a machine learning (ML)
interface where users only need to provide the name of the ML method and the rest
are handled automatically.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ml.run</span><span class="op">(</span></span>
<span>  allDF <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  trainDF <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  testDF <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  preProc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"center"</span>, <span class="st">"scale"</span>, <span class="st">"nzv"</span><span class="op">)</span>,</span>
<span>  <span class="va">classCol</span>,</span>
<span>  posLabel <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  negLabel <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">cMethod</span>,</span>
<span>  packName <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  trainInd <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dummyEncoding <span class="op">=</span> <span class="va">cMethod</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"xgbTree"</span>, <span class="st">"svmRadial"</span><span class="op">)</span>,</span>
<span>  prior.nzvCondX <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  prior.impute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="st">"missForest"</span>, <span class="st">"KNN"</span><span class="op">)</span>,</span>
<span>  oDir <span class="op">=</span> <span class="st">"."</span>,</span>
<span>  trainCtrlParas <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  trainParas <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-alldf">allDF<a class="anchor" aria-label="anchor" href="#arg-alldf"></a></dt>
<dd><p>NULL, data.frame; the data.frame of all the data where rows are
observations and columns are features; training and testing will be sampled
at the ratio of 75 vs 25.</p></dd>


<dt id="arg-traindf">trainDF<a class="anchor" aria-label="anchor" href="#arg-traindf"></a></dt>
<dd><p>NULL, data.frame; the data.frame of the training data</p></dd>


<dt id="arg-testdf">testDF<a class="anchor" aria-label="anchor" href="#arg-testdf"></a></dt>
<dd><p>NULL, data.frame; the data.frame of the testing data</p></dd>


<dt id="arg-preproc">preProc<a class="anchor" aria-label="anchor" href="#arg-preproc"></a></dt>
<dd><p><code>c("center", "scale",'nzv')</code>, char vector; preprocessing options; see <code><a href="https://rdrr.io/pkg/caret/man/preProcess.html" class="external-link">caret::preProcess()</a></code></p></dd>


<dt id="arg-classcol">classCol<a class="anchor" aria-label="anchor" href="#arg-classcol"></a></dt>
<dd><p>char; the column name of the class, i.e. the target variable</p></dd>


<dt id="arg-poslabel-neglabel">posLabel, negLabel<a class="anchor" aria-label="anchor" href="#arg-poslabel-neglabel"></a></dt>
<dd><p>NULL, char; for classification only; the positive and negative labels for two-class classification</p></dd>


<dt id="arg-cmethod">cMethod<a class="anchor" aria-label="anchor" href="#arg-cmethod"></a></dt>
<dd><p>char; the name of the ML method</p></dd>


<dt id="arg-packname">packName<a class="anchor" aria-label="anchor" href="#arg-packname"></a></dt>
<dd><p>NULL, char; the name of the package containing the ML method.
It's not needed if the <code>cMethod</code> is among those preset in <a href="method2package.html">method2package</a></p></dd>


<dt id="arg-trainind">trainInd<a class="anchor" aria-label="anchor" href="#arg-trainind"></a></dt>
<dd><p>NULL, list of integers; the indices of the resampling iteration in CV; see <code>index</code> in <code><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">caret::trainControl()</a></code></p></dd>


<dt id="arg-dummyencoding">dummyEncoding<a class="anchor" aria-label="anchor" href="#arg-dummyencoding"></a></dt>
<dd><p><code>cMethod %in% c('xgbTree','svmRadial')</code>,logical; is dummy variable
encoding needed on the combined training and testing datasets before training?
Although <code><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">caret::train()</a></code> handles dummy variable encoding automatically during CV and
prediction on testing. It's possible that there are levels in the holdout or
testing samples that are absent from the training data, causing errors.</p></dd>


<dt id="arg-prior-nzvcondx">prior.nzvCondX<a class="anchor" aria-label="anchor" href="#arg-prior-nzvcondx"></a></dt>
<dd><p>NULL, char; remove NZV and conditionalX variables before training.
This can be used only if <code><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">caret::train</a></code> is not used in the model building.
Following are the available options:</p><ul><li><p><code>NULL</code>: do not remove before training</p></li>
<li><p>one of <code>n, nx</code>:</p><ul><li><p>n: NZV</p></li>
<li><p>nx: NZV and ConditionalX
if detected, removed variables are written to files <code>nzv.csv</code> and <code>conditionalX.txt</code></p></li>
</ul></li>
</ul></dd>


<dt id="arg-prior-impute">prior.impute<a class="anchor" aria-label="anchor" href="#arg-prior-impute"></a></dt>
<dd><p><code>c(NA,'missForest','KNN')</code>, char; impute missing values before training.
This can be used only if <code><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">caret::train</a></code> is not used in the model building.
Following are the available options:</p><ul><li><p><code>NA</code>: do not impute before training</p></li>
<li><p>one of <code>missForest, KNN</code>: impute using <code><a href="https://rdrr.io/pkg/missForest/man/missForest.html" class="external-link">missForest::missForest()</a></code> or <code><a href="https://rdrr.io/pkg/DMwR2/man/knnImputation.html" class="external-link">DMwR2::knnImputation()</a></code></p></li>
</ul></dd>


<dt id="arg-odir">oDir<a class="anchor" aria-label="anchor" href="#arg-odir"></a></dt>
<dd><p>NULL, char; output directory</p></dd>


<dt id="arg-trainctrlparas">trainCtrlParas<a class="anchor" aria-label="anchor" href="#arg-trainctrlparas"></a></dt>
<dd><p>NULL, list; parameters for train control in <code><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">caret::trainControl()</a></code>.
Here are its default values if <code>method</code> is not <code>oob</code>:</p><ul><li><p><code>savePredictions = 'final'</code>,</p></li>
<li><p>if <code>trainInd</code> is provided, <code>index = trainInd</code></p></li>
<li><p>otherwise <code>method = "repeatedcv",repeats = 3,number = 10</code>, which has the best bias-variance balance based on this
<a href="http://appliedpredictivemodeling.com/blog/2014/11/27/vpuig01pqbklmi72b8lcl3ij5hj2qm" class="external-link">post</a>
from Max Kuhn, the author of <code>caret</code>.</p></li>
</ul><p>additional defaults for classification:</p><ul><li><p><code>classProbs = TRUE</code>,</p></li>
<li><p><code>summaryFunction = twoClassSummary</code> or <code>multiClassSummary</code> depending on the class column</p></li>
</ul></dd>


<dt id="arg-trainparas">trainParas<a class="anchor" aria-label="anchor" href="#arg-trainparas"></a></dt>
<dd><p>NULL, list; parameters for train in <code><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">caret::train()</a></code>.
Here are its default values:</p><ul><li><p><code>tuneLength = 10</code></p>
<p><code>tuneLength</code> is the number of levels for each tuning parameters that should
be generated by train. If trainControl has the option <code>search = "random"</code>, this
is the maximum number of tuning parameter combinations that will be generated
by the random search. if <code>search = "grid"</code> which is the default, this is the maximum number of levels
of each tuning parameter. The actual number of levels used may be less than tuneLength.
additional defaults for classification:</p></li>
<li><p><code>metric = "ROC"</code> or <code>'Accuracy'</code> depending on the class column</p></li>
</ul></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a list of the following items</p><ul><li><p><code>imp</code>: data.frame, variable importance scores</p></li>
<li><p><code>trainStats</code>: a named numerical vector containing AUC and various stats
in the confusion table from the prediction on the training dataset.</p></li>
<li><p><code>testStats</code>: similar, but from the testing dataset.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The capabilities of this function include the following:</p><ul><li><p>preprocessing of the whole dataset</p><ul><li><p>dummy variable encoding</p></li>
<li><p>modification to the whole dataset before training, including</p><ul><li><p>imputation using <code>missForest</code> and <code>KNN</code></p></li>
<li><p>detection and removal of <code>Near Zero Variance (NZV)</code> and <code>ConditionalX</code> variables
Note that these modifications apply only in situations where <code><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">caret::train</a></code>
is not used in the model building; for example</p>
<p>✦ ML method is <code>glm</code> where no cross validation (CV) is needed due to the absence of hyper-parameters</p>
<p>✦ ML method is <code>randomForest</code> where the training is done using <code><a href="https://rdrr.io/pkg/randomForest/man/tuneRF.html" class="external-link">randomForest::tuneRF()</a></code></p></li>
</ul><p>Otherwise, those modification should be specified in <code>preProc</code> to avoid
information leakage during training. Note that <code>missForest</code> is not available
in <code>preProc</code>.</p></li>
</ul></li>
<li><p>training and testing</p></li>
<li><p>the output of various files of the training and testing stats:</p><ul><li><p><em>nzv.csv</em>: columns removed due to NZV and the details of each columns</p></li>
<li><p><em>train.all.stats.rds</em>: stats of the prediction of training model on the training dataset</p></li>
<li><p><em>train.cv.pdf</em>: curve of prediction performance during CV for upto four tuning parameters</p></li>
<li><p><em>train.model.rds</em></p></li>
<li><p><em>train.prediction.csv</em>: prediction for each subject in training set</p></li>
<li><p><em>train.var.imp.pdf</em>: plot of variable importance</p></li>
<li><p><em>train.var.imp.csv</em>: importance score of each variable</p></li>
<li><p><em>test.all.stats.rds</em></p></li>
<li><p><em>test.prediction.csv</em></p></li>
<li><p><em>$cMethod.image.rdata</em>: running environment
for classification</p></li>
<li><p><em>train.confusion.table.txt</em></p></li>
<li><p><em>train.prediction.hist.pdf</em>: prediction histogram</p></li>
<li><p><em>train.roc.pdf</em>: ROC curve</p></li>
<li><p><em>train.MDS12.png, train.MDS13.png, train.MDS23.png</em>: MDS plots of subjects if trained via <code>randomForest</code></p></li>
<li><p><em>test.confusion.table.txt</em></p></li>
<li><p><em>test.prediction.hist.pdf</em></p></li>
<li><p><em>test.roc.pdf</em></p></li>
<li><p><em>test.MDS12.png, test.MDS13.png, test.MDS23.png</em></p></li>
<li><p><em>conditionalX.txt</em>: columns removed due to conditionalX
for regression</p></li>
<li><p><em>train.pred.cor.png</em>: scatter plot of raw and predicted values</p></li>
<li><p><em>train.pred.residual.png</em>: various diagnostic residual plots</p></li>
<li><p><em>test.pred.cor.png</em>: scatter plot of raw and predicted values</p></li>
<li><p><em>test.pred.residual.png</em>: plots of raw and standardized residuals</p></li>
</ul></li>
<li><p>errors are handled to avoid crush.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># see https://blueskypie.github.io/ezML/articles/ezML-intro.html</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jike Cui.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

